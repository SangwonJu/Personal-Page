---
title: "EDA Assignment 7: Chapter 9"
author: "연세대학교 행정학과 2015128003 주상원"
date: '2021 6 3'
output:
  html_document:
    df_print: paged
  word_document: default
---

# 1번

R의 trees 자료를 이용하여 다음을 수행하여라.

## (가)

Volume을 Y축에, Height를 X축에 그리고 또한 Volume을 Y축에, Girth를 X축에 그린 후 두 그래프에서 자료들판단)이 직선으로 모형을 세우기 적합한 지, 선형성이 어떤 것이 더 강한지 비교하여라. (눈으로 판단)

```{r}


pacman::p_load("skimr","tidyverse")
trees %>% glimpse()
skimr::skim(trees)

sum(is.na(trees)) # 결측치 없음
plot(y=trees$Volume,x=trees$Height,main="Linearity of volume and height",xlab="height",ylab="volume")
plot(y=trees$Volume,x=trees$Girth,main="Linearity of volume and girth",xlab="girth",ylab="volume")
```

첫번째 자료의 경우 경향성이 따로 나타나지 않는 것으로 보인다. 두 Plot을 비교할 경우 두번째 자료(volume,girth)가 직선으로 모형으로 세우기 적합하다고 본다. X축과 Y축의 선형성 또한 두번째 자료가 더 강하게 나타나는 것으로 보인다.

## (나)

각각 r-line을 적합 시킨 후 그래프 위에 그려라. 각기 잔차를 구하여 y-hat vs. residual plot을 그리고 적합 타당성을 판단하고 비교하여라.

```{r}
# 첫번째 플롯에 대해서
plot(y=trees$Volume,x=trees$Height,main="Linearity of volume and height",xlab="height",ylab="volume")
(z1 <- line(x=trees$Height,y=trees$Volume))
abline(coef(z1))
z1.ls <- lm(trees$Volume ~ trees$Height)
abline(z1.ls$coef, lty=2,col="red")
legend(x = 63, y = 72, c("R - Line", "Regression"), 
       lty=c(1,2),lwd=2,col = c("black","red"),cex=0.7)

# Tukey-Tree Plot :
plot(residuals(z1) ~ fitted(z1), main = "Residual plot by rline:Volume~Height")
abline(0,0)       

boxplot(residuals(z1)) # outlier 없음

# 두번째 플롯에 대해서
plot(y=trees$Volume,x=trees$Girth,main="Linearity of volume and girth",xlab="girth",ylab="volume")
(z2 <- line(x=trees$Girth,y=trees$Volume))
abline(coef(z2))
z2.ls <- lm(trees$Volume ~ trees$Girth)
abline(z2.ls$coef, lty=2,col="red")
legend(x = 8.5, y = 71, c("R - Line", "Regression"), 
       lty=c(1,2),lwd=2,col = c("black","red"),cex=0.7)

# Tukey-Tree Plot :
plot(residuals(z2) ~ fitted(z2), main = "Residual plot by rline: Volume~Height")
abline(0,0)    

# 이차함수를 따를지도 모른다.
k=seq(-100,100,0.1)
a<-function(x) {((1/50)*(x-35)^2)-8}
lines(a(k)~k)

boxplot(residuals(z2)) # outlier 없음
```

첫번째 Plot의 경우 이 분산성이 발생하는 것으로 보인다. Y_hat이 작을 때에는 잔차의 폭이 좁았는데 점점 커질수록 잔차의 폭이 넓어지고 있는 모습을 보이고 있다는 점에서 그러하다. Ideal한 Residual Plot은 띠 모양으로 Plot의 점들이 x축에 평행한 직선을 이루어야 하는데 Plot에서의 잔차는 점차 늘어나고 있다는 점에서 Transformation을 통해 잔차를 조정해야 한다.

두번째 Plot의 경우에도 점들이 x축에 평행하게 모여있지는 않고 일종의 Qudratic Form (2차함수) 곡선을 이루고 있는 것으로 보인다.Ideal한 Residual Plot은 띠 모양으로 Plot의 점들이 x축에 평행 직선을 이루어야 하는데 실제 Plot의 모양은 곡선을 이루고 있는 것으로 보아 변수 들을 변환한다면 현재의 잔차들이 가지고 있는 경향성을 완화할 수 있을 것이라고 생각한다.

## (다)

Volume \~ Height plot에서 직선화하기 위한 재표현을 시행착오 방법으로 찾아라. Volume만 변환시켜 보아라. Height만 변환시켜 보아라. 시행착오 과정을 모두 수록하여라.

```{r}
# 단순화
attach(trees)
medHeight <- as.vector(3)
medVolume <- as.vector(3)
medHeight[1] <- median(Height[1:10]); medVolume[1] <- median(Volume[1:10])
medHeight[2] <- median(Height[11:21]); medVolume[2] <- median(Volume[11:21])
medHeight[3] <- median(Height[22:31]); medVolume[3] <- median(Volume[22:31])
plot(medVolume~medHeight, type="b",main="MedVolume~MedHeight")   # "b"= both points and line
detach(trees)

# 시행착오
# 먼저 Y변수에 대해서 큰부분을 작게 작은 부분을 크게 만드는 변환
plot(y=sqrt(trees$Volume),x=trees$Height,main="Linearity of sqrt(volume) and height",xlab="height",ylab="sqrt volume")
plot(y=log(trees$Volume),x=trees$Height,main="Linearity of log(volume) and height",xlab="height",ylab="log volume")
# X변수에 대해서 변환을 진행
plot(y=trees$Volume,x=(trees$Height)^2,main="Linearity of volume and height squares",xlab="height squares",ylab="volume")
# 책에서 제시한 변환법
vh=trees$Volume/trees$Height
plot(y=vh,x=trees$Height,main="Linearity of volume/height and height",xlab="height",ylab="volume/height")


# Volume만 변화시키기
# 1) y에 Sqrt 씌우기

plot(y=sqrt(trees$Volume),x=trees$Height,main="Linearity of sqrt(volume) and height",xlab="height",ylab="sqrt volume")
(z3 <- line(x=trees$Height,y=sqrt(trees$Volume)))
abline(coef(z3))
z3.ls <- lm(sqrt(trees$Volume) ~ trees$Height)
abline(z3.ls$coef, lty=2,col="red")
legend(x = 63, y = 8.5, c("R - Line", "Regression"), 
       lty=c(1,2),lwd=2,col = c("black","red"),cex=0.7)

# 2) y에 Log 씌우기

plot(y=log(trees$Volume),x=trees$Height,main="Linearity of log(volume) and height",xlab="height",ylab="log volume")
(z4 <- line(x=trees$Height,y=log(trees$Volume)))
abline(coef(z4))
z4.ls <- lm(log(trees$Volume) ~ trees$Height)
abline(z4.ls$coef, lty=2,col="red")
legend(x = 63, y = 4.2, c("R - Line", "Regression"), 
       lty=c(1,2),lwd=2,col = c("black","red"),cex=0.7)

# 3) x에 제곱 씌우기
plot(y=trees$Volume,x=(trees$Height)^2,main="Linearity of volume and height squares",xlab="height squares",ylab="volume")
(z5 <- line(x=(trees$Height)^2,y=trees$Volume))
abline(coef(z5))
k=(trees$Height)^2
z5.ls <- lm(trees$Volume ~k )
abline(z5.ls$coef, lty=2,col="red")
legend(x = 4000, y = 72, c("R - Line", "Regression"), 
       lty=c(1,2),lwd=2,col = c("black","red"),cex=0.7)

# 4) Huh
vh=trees$Volume/trees$Height
plot(y=vh,x=trees$Height,main="Linearity of volume/height and height",xlab="height",ylab="volume/height")
(z6 <- line(x=trees$Height,y=vh))
abline(coef(z6))
z6.ls <- lm(vh~trees$Height)
abline(z6.ls$coef, lty=2,col="red")
legend(x = 64, y = 0.85, c("R - Line", "Regression"), 
       lty=c(1,2),lwd=2,col = c("black","red"),cex=0.7)

```

총 네가지 방법으로 변환을 진행해 보았는데 4가지 표현 중 x변수를 변환하는 방법의 경우 r-line 위쪽 부분의 점들이 어느정도 r-line에 평행하게 선형성을 보이고 있으나 밑부분의 점들은 선형적이지 않아 선택하지 않았다. y변수에 대한 변환 중 log와 sqrt를 비교할 경우 log 변환을 한 Plot의 가장 큰 점인 (90,4.5) 부근에 한 점이 가장자리 점들을 기준으로 한 선위에서 약간 벗어난 것으로 보이기 때문에 y변수에 대한 sqrt 변환이 log변환에 비해서 적합하다고 판단하였다.

```{r}
plot(y=log(trees$Volume),x=log(trees$Height),main="Linearity of log(volume) and log(height)",xlab="log height",ylab="log volume")
(z7 <- line(x=log(trees$Height),y=log(trees$Volume)))
abline(coef(z7))
z7.ls <- lm(log(trees$Volume) ~ log(trees$Height))
abline(z7.ls$coef, lty=2,col="red")
legend(x = 4.15, y = 4.15, c("R - Line", "Regression"), 
       lty=c(1,2),lwd=2,col = c("black","red"),cex=0.7)

plot(y=sqrt(trees$Volume),x=sqrt(trees$Height),main="Linearity of sqrt(volume) and sqrt(height)",xlab="sqrt height",ylab="sqrt volume")
(z8 <- line(x=sqrt(trees$Height),y=sqrt(trees$Volume)))
abline(coef(z8))
z8.ls <- lm(sqrt(trees$Volume) ~ sqrt(trees$Height))
abline(z8.ls$coef, lty=2,col="red")
legend(x = 8, y = 8.5, c("R - Line", "Regression"), 
       lty=c(1,2),lwd=2,col = c("black","red"),cex=0.7)

```

추가로 x축 y축 전부에 log와 sqrt 변환을 적용하였는데 위의 변환들 보다 잔차들이 안정되어진 것으로 추정된다.

## (라)

(다)에 찾은 변환으로 각기 r-line으로 적합하고 residual plot, residual의 boxplot, stem-and-leaf display 등으로 적합성를 비교하여라.

```{r}
plot(residuals(z3) ~ fitted(z3), main = "Residual plot by rline:sqrt(volume) ~ height")
abline(0,0)    
plot(residuals(z4) ~ fitted(z4), main = "Residual plot by rline:log(volume) ~ height")
abline(0,0) 
plot(residuals(z5) ~ fitted(z5), main = "Residual plot by rline:volume ~ height^2")
abline(0,0)    
plot(residuals(z6) ~ fitted(z6), main = "Residual plot by rline:volume/height ~ height")
abline(0,0) 
plot(residuals(z7) ~ fitted(z7), main = "Residual plot by rline:log volume ~ log height")
abline(0,0) 
plot(residuals(z8) ~ fitted(z8), main = "Residual plot by rline:sqrt volume ~ sqrt height")
abline(0,0) 
```

그러나 Residual plot을 그려볼 경우 여러 변환들 중 적합해 보이는 것은 y변수에 대한 log 변환인 것으로 보인다. 나머지 변환의 경우 직선 밑 부분의 점들이 점점 줄어들고 있는 경향성이 나타나고 있는데 그럴경우 적합하지 않은 변환이기 때문이다

y변수에만 log변환을 한 경우를 다른 Residual plot을 비교할 경우 미묘한 차이지만 맨위에 있는 4개의 점들이 줄어드는 경향성이 있고 마지막점의 이상성이 다소 있다는 점에서 단점이 있지만 전반적인 Residual Plot을 비교하면 log가 가장 적정해 보인다.

```{r}
boxplot(residuals(z3),main="Residual boxplot of sqrt(volume) ~ height")
boxplot(residuals(z4),main="Residual boxplot of log(volume) ~ height")
boxplot(residuals(z5),main="Residual boxplot of volume ~ height^2")
boxplot(residuals(z6),main="Residual boxplot of volume/height ~ height")
boxplot(residuals(z7),main="Residual boxplot of xy log")
boxplot(residuals(z8),main="Residual boxplot of xy sqrt")
```

첫번째, 두번째 boxplot의 경우 median이 lower hinge쪽에 더 가까운 것으로 보인다. 또 Whisker의 길이도 lower whisker쪽이 더 길게 나타나고 있다. Whisker의 길이와 Box내의 대칭성의 경우 3번째 Boxplot이 가장 대칭적인 것으로 보인다. 그럼에도 불구하고 log변환에서 대칭성이 크게 감소하지는 않았다는 점에서 사용 가능한 변환으로 보인다.

x변수와 y변수에 동시에 log변환을 취한 boxplot이 y변수에만 log변환을 취한 boxplot에 비해서 whisker의 길이가 대칭적이 된 것으로 보인다.

```{r}
stem(residuals(z3))
stem(residuals(z4))
stem(residuals(z5))
stem(residuals(z6))
stem(residuals(z7))
stem(residuals(z8))

stem(residuals(z3),0.5)
stem(residuals(z4),0.5)
stem(residuals(z5),0.5)
stem(residuals(z6),0.5)
stem(residuals(z7),0.5)
stem(residuals(z8),0.5)
```

전반적으로 가장 큰 Cluster를 기준으로 대칭적인 종모양을 띄고 있지는 않은 것으로 보인다. y변수에 대한 sqrt변환의 경우와 log변환의 경우 그리고 x변수에 대한 제곱 변환의 경우 한개의 Cluster가 아니라 여러개의 Cluster가 있는 것으로 보인다. 교재에서 제시한 변환 방식이 Skewed to the right 되어 있지만 그나마 한개의 종모양의 형태를 띄고 있는 것으로 보인다.

xy변수에 대한 log변환을 취한 경우 Stem 4를 제외하면 전반적으로 종모양이 잘 이루어지고 있는 것으로 보인다. stem 4가 이상치가 아니라면 2개의 cluster에 의한 쌍봉분포일 것이고, stem 4가 이상치라면 정규분포를 잘 이루고 있는 것으로 볼 수 있다.

# 2번

R의 airquality 자료를 이용하여 Ozone의 양을 제일 잘 예측할 수 있는 변수를 찾으려고 한다. 이 자료는 결측치가 많은 자료이다. 결측치를 분석에서 제외할 때 두 가지 방법이 있다.

하나는 네 변수 중에 하나라도 결측값이 있으면 모두 사용하지 않는 방법 (이 자료의 경우는 해당 row를 사용하지 않음; case-wise deletion) 인데 그렇게 되면 너무 많은 자료를 잃게 된다. 다른 하나는 각 분석단계에서 가능한 많은 자료를 이용하는 방법이 있다(pair-wise deletion). 예를 들면 Ozone의 평균값을 구할 때는 Ozone의 결측값만 제외시키고, Ozone과 Solar.R의 r-line 구할 때는 Ozone과 Solar.R에서만 결측이 생긴 자료를 제외하고 분석하는 것이다. 여기서의 분석은 두 번째 방법으로 하여라. R command 사용시 결측값을 제외시키는 작업을 따로 하지 않아도 자동으로 두 번째 방법이 적용된다.

## (가)

Ozone을 Y변수로 하고, Solar.R, Wind, Temp 각각의 세 X 변수에 대하여 산점도를 그리고 변환이 필요하면 변환하여 r-line으로 적합한 후 residual 분석 등으로 최적 X 변수의 순위를 선정하여라.

### 결측치 확인하기

```{r}
data("airquality")

colSums(is.na(airquality))
dim(airquality)
round(colSums(is.na(airquality))/dim(airquality)[1]*100,2)
```

Ozone 자료의 결측치 비율이 24.18%로 거의 1/4에 해당하는 자료에 대한 Ozone 데이터가 나타나지 않은 것으로 보인다. 따라서 분석을 진행 할때 있어 이부분을 유의해야 할 것으로 보인다. Solar.R자료는 약 4.58%에 해당하는 자료가 현재 결측되어진 것으로 보인다.

### Ozone\~Solar.R

```{r}
attach(airquality)
plot(Ozone~Solar.R,main="linearity of Ozone ~ Solar")
length(Ozone) # 51개씩 쪼개기

airquality2=airquality[order(airquality$Solar.R),]

medOzone <- as.vector(3)
medSolar <- as.vector(3)
medOzone[1] <- median(airquality2$Ozone[1:51],na.rm=T); medSolar[1] <- median(airquality2$Solar.R[1:51],na.rm=T)
medOzone[2] <- median(airquality2$Ozone[52:102],na.rm=T); medSolar[2] <- median(airquality2$Solar.R[52:102],na.rm=T)
medOzone[3] <- median(airquality2$Ozone[103:153],na.rm=T); medSolar[3] <- median(airquality2$Solar.R[103:153],na.rm=T)
plot(medOzone ~ medSolar, type="b") 
# 선형관계보다는 기울기가 음수인 이차함수의 관계인 것으로 보인다. y변수 변환을 통해 선형성을 확보 

plot(y=log(Ozone),x=Solar.R,main="Linearity of log(Ozone) and Solar.R",xlab="Solar.R",ylab="log(Ozone)")
(z1 <- line(y=log(Ozone),x=Solar.R))
abline(coef(z1))
z1.ls <- lm(log(Ozone) ~ Solar.R)
abline(z1.ls$coef, lty=2,col="red")
legend(x = 250, y = 1, c("R - Line", "Regression"), 
       lty=c(1,2),lwd=2,col = c("black","red"),cex=0.7)

plot(y=sqrt(Ozone),x=Solar.R,main="Linearity of sqrt(Ozone) and Solar.R",xlab="Solar.R",ylab="sqrt(Ozone)")
(z2 <- line(y=sqrt(Ozone),x=Solar.R))
abline(coef(z2))
z2.ls <- lm(sqrt(Ozone) ~ Solar.R)
abline(z2.ls$coef, lty=2,col="red")
legend(x = 10, y = 12, c("R - Line", "Regression"), 
       lty=c(1,2),lwd=2,col = c("black","red"),cex=0.7)

s2=Solar.R^2
plot(y=Ozone,x=s2,main="Linearity of Ozone and Solar.R^2",xlab="Solar.R^2",ylab="Ozone")
(z3 <- line(y=Ozone,x=s2))
abline(coef(z3))
z3.ls <- lm(Ozone ~ s2)
abline(z3.ls$coef, lty=2,col="red")
legend(x = 10, y =150, c("R - Line", "Regression"), 
       lty=c(1,2),lwd=2,col = c("black","red"),cex=0.7)


plot(residuals(z1) ~ fitted(z1), main = "Residual plot by rline:log y ~ x")
abline(0,0) 
plot(residuals(z2) ~ fitted(z2), main = "Residual plot by rline:sqrt y ~ x")
abline(0,0) 
plot(residuals(z3) ~ fitted(z3), main = "Residual plot by rline: y~ x^2")
abline(0,0) 



# log 변환 
boxplot(residuals(z1)) # outlier 1개
boxplot(residuals(z2)) # outlier 없음
boxplot(residuals(z3)) # outlier 2개

# stem and leaf
stem(residuals(z1))
stem(residuals(z2))
stem(residuals(z3))

cor.test(Ozone,Solar.R,na.rm=T)
cor.test(log(Ozone),Solar.R,na.rm=T)
cor.test(sqrt(Ozone),Solar.R,na.rm=T)
cor.test(Ozone,s2,na.rm=T)

# y변수에 그래프의 잔차제곱 합
sum(residuals(z1)^2)
sum(residuals(z2)^2)
sum(residuals(z3)^2)

detach(airquality)
```

총 3가지 변환 중 y축에 대한 변환들이 잔차들이 안정되어진 것으로 보인다. 1번 변환 (y변수만 log 변환)의 경우 자료가 잘 퍼져있다는 장점이 있으나 잔차들의 곡선의 경향성이 완전히 사라지지는 않은 것으로 보인다. 잔차의 크기가 작은 편이다. 2번 변환 (y변수만 sqrt 변환)의 경우 자료에서의 곡선성이 거의 사라졌다는 장점이 있으나 잔차의 y축으로 퍼진 범위가 넓어졌다.

변환한 그래프들을 기준으로 전반적으로 Ozone량과 Solar.R의 값은 양의 상관관계를 가지고 있는 것으로 보인다.

### Ozone\~Wind

```{r}
attach(airquality)
attach(airquality)
plot(Ozone~Wind,main="linearity of Ozone ~ Wind")
(z <- line(x=Wind,y=Ozone))
abline(coef(z))
z.ls <- lm(Ozone~Wind)
abline(z.ls$coef, lty=2,col="red")
legend(x = 16, y = 150, c("R - Line", "Regression"), 
       lty=c(1,2),lwd=2,col = c("black","red"),cex=0.7)

airquality2=airquality[order(airquality$Wind),]

medOzone <- as.vector(3)
medWind <- as.vector(3)
medOzone[1] <- median(airquality2$Ozone[1:51],na.rm=T); medWind[1] <- median(airquality2$Wind[1:51],na.rm=T)
medOzone[2] <- median(airquality2$Ozone[52:102],na.rm=T); medWind[2] <- median(airquality2$Wind[52:102],na.rm=T)
medOzone[3] <- median(airquality2$Ozone[103:153],na.rm=T); medWind[3] <- median(airquality2$Wind[103:153],na.rm=T)
plot(medOzone ~ medWind, type="b") 

# 감소하는 convex 함수의 관계인 것으로 보인다. y변수 변환을 통해 선형성을 확보
plot(y=log(Ozone),x=Wind,main="Linearity of log(Ozone) and Wind")
(z1 <- line(y=log(Ozone),x=Wind))
abline(coef(z1))
z1.ls <- lm(log(Ozone) ~ Wind)
abline(z1.ls$coef, lty=2,col="red")
legend(x = 2, y = 1, c("R - Line", "Regression"), 
       lty=c(1,2),lwd=2,col = c("black","red"),cex=0.7)

plot(y=sqrt(Ozone),x=Wind,main="Linearity of sqrt(Ozone) and Wind")
(z2 <- line(y=sqrt(Ozone),x=Wind))
abline(coef(z2))
z2.ls <- lm(sqrt(Ozone) ~ Wind)
abline(z2.ls$coef, lty=2,col="red")
legend(x = 16, y = 12, c("R - Line", "Regression"), 
       lty=c(1,2),lwd=2,col = c("black","red"),cex=0.7)
w2=Wind^2
plot(y=Ozone,x=w2,main="Linearity of Ozone and Wind^2")
(z3 <- line(y=Ozone,x=w2))
abline(coef(z3))
z3.ls <- lm(Ozone ~ w2)
abline(z3.ls$coef, lty=2,col="red")
legend(x = 300, y =150, c("R - Line", "Regression"), 
       lty=c(1,2),lwd=2,col = c("black","red"),cex=0.7)

plot(residuals(z1) ~ fitted(z1), main = "Residual plot by rline")
abline(0,0) 
plot(residuals(z2) ~ fitted(z2), main = "Residual plot by rline")
abline(0,0) 
plot(residuals(z3) ~ fitted(z3), main = "Residual plot by rline")
abline(0,0) 

boxplot(residuals(z1)) # three outliers
boxplot(residuals(z2)) # one outlier
boxplot(residuals(z3)) # two outliers


stem(residuals(z1))
stem(residuals(z2))
stem(residuals(z3))

# y변수 그래프의 잔차제곱 합
sum(residuals(z1)^2)
sum(residuals(z2)^2)
sum(residuals(z3)^2)

cor.test(Ozone,Wind,na.rm=T)
cor.test(log(Ozone),Wind,na.rm=T)
cor.test(sqrt(Ozone),Wind,na.rm=T)
cor.test(Ozone,w2,na.rm=T)
detach(airquality)
```

3가지 변환 중 Ozone에 sqrt를 취한 변환이 가장 적절해 보인다. Boxplot 기준으로 Residual에서 한개의 Outlier가 존재하고 median에서 hinge들 까지의 길이와 whisker의 길이들이 서로 각각 대칭적인 것으로 보인다. 줄기 잎 그림을 그렸더니 두 변환에서 모두 0을 중심으로 하는 종모양을 어느정도 이루고 있는 것으로 보인다. 변환 이전에 비해서 잔차들이 안정된 것으로 보이지만 완전하지 않다. 변환한 데이터들 기준으로 Ozone과 Wind는 전반적으로 음의 상관관계를 보이고 있는 것을 확인할 수 있다.

```{r}
### Ozone~Temp
attach(airquality)
plot(Ozone~Temp,main="linearity of Ozone ~ Temp")
(z <- line(x=Temp,y=Ozone))
abline(coef(z))
z.ls <- lm(Ozone~Temp)
abline(z.ls$coef, lty=2,col="red")
legend(x = 58, y = 150, c("R - Line", "Regression"), 
       lty=c(1,2),lwd=2,col = c("black","red"),cex=0.7)
# 직선에서 많이 떨어져있는 3~5개정도의 점을 제외하면 전반적으로 변수들이 양의 상관관계를 보이고 있는 것으로 보인다.

airquality3=airquality[order(airquality$Temp),]

medOzone <- as.vector(3)
medTemp <- as.vector(3)
medOzone[1] <- median(airquality3$Ozone[1:51],na.rm=T); medTemp[1] <- median(airquality3$Temp[1:51],na.rm=T)
medOzone[2] <- median(airquality3$Ozone[52:102],na.rm=T); medTemp[2] <- median(airquality3$Temp[52:102],na.rm=T)
medOzone[3] <- median(airquality3$Ozone[103:153],na.rm=T); medTemp[3] <- median(airquality3$Temp[103:153],na.rm=T)
plot(medOzone ~ medTemp, type="b") 

# 증가하는 convex 함수의 관계인 것으로 보인다. y변수 변환을 통해 선형성을 확보 

plot(y=log(Ozone),x=Temp,main="Linearity of log ozone and temp",xlab="temp",ylab="log Ozone")
(z1<- line(y=log(Ozone),x=(Temp)))
abline(coef(z1))
z1.ls <- lm(log(Ozone) ~ Temp)
abline(z1.ls$coef, lty=2,col="red")
legend(x = 58, y = 5, c("R - Line", "Regression"), 
       lty=c(1,2),lwd=2,col = c("black","red"),cex=0.7)

plot(y=sqrt(Ozone),x=Temp,main="Linearity of sqrt ozone and temp",xlab="temp",ylab="sqrt Ozone")
(z2<- line(y=sqrt(Ozone),x=Temp))
abline(coef(z2))
z2.ls <- lm(sqrt(Ozone) ~ Temp)
abline(z2.ls$coef, lty=2,col="red")
legend(x = 58, y = 12, c("R - Line", "Regression"), 
       lty=c(1,2),lwd=2,col = c("black","red"),cex=0.7)

t2=Temp^2
plot(Ozone~t2,main="linearity of Ozone ~ Temp^2")
(z3 <- line(x=t2,y=Ozone))
abline(coef(z3))
z3.ls <- lm(Ozone~t2)
abline(z3.ls$coef, lty=2,col="red")
legend(x = 3000, y = 150, c("R - Line", "Regression"), 
       lty=c(1,2),lwd=2,col = c("black","red"),cex=0.7)


plot(residuals(z1) ~ fitted(z1), main = "Residual plot by rline")
abline(0,0) 
plot(residuals(z2) ~ fitted(z2), main = "Residual plot by rline")
abline(0,0) 
plot(residuals(z3) ~ fitted(z3), main = "Residual plot by rline")
abline(0,0) 

boxplot(residuals(z1)) # 5 outliers
boxplot(residuals(z2)) # 2 outliers
boxplot(residuals(z3)) # 3 outliers

stem(residuals(z1))
stem(residuals(z2))
stem(residuals(z3))

# y변수 그래프의 잔차제곱 합
sum(residuals(z1)^2)
sum(residuals(z2)^2)
sum(residuals(z3)^2)

cor.test(Ozone,Temp)
cor.test(sqrt(Ozone),(Temp))
cor.test(log(Ozone),(Temp))
cor.test((Ozone),t2)
detach(airquality)
```

3가지 변환 중 sqrt 변환이 가장 적절해 보인다. boxplot 기준으로 median에서 hinge들까지의 거리가 적절해보이고 (다소 위쪽으로 몰려있는 것 처럼 보이지만), whisker의 길이도 대칭적인 것으로 보인다. 다만 outlier의 수는 2개이다. Stem and Leaf Plot에서 변환 이후 데이터에서 종 모양이 대칭적으로 나타나는 것 처럼 보인다.

변환한 데이터들 기준으로 Ozone과 Temp는 전반적으로 양의 상관관계를 보이고 있는 것을 확인할 수 있다.

변환된 데이터들의 Residual plot들을 기준으로 볼 때 예측력이 가장 높은 지표는 Wind변수이고, 다음으로는 Temp변수이고, 다음으로는 Solar.R변수 인 것으로 추측된다. Residual들이 가장 넓게 퍼져있는 지표는 Soalr.R변수이고 나머지 두변수들은 Residual이 원형으로 다소 뭉쳐있는데 상대적으로 Temp 변수들이 많이 퍼져있기 때문에 Wind 변수의 순위를 높게 잡았다.

X\~Y둘다 변환

```{r}

choose(3,1)

attach(airquality)
# Ozone ~ Solar.R
cor.test(Ozone,Solar.R)
plot(y=log(Ozone),x=Solar.R,main="R-line")
abline(line(y=log(Ozone),x=Solar.R)$coeff)


plot(y=log(Ozone),x=log(Solar.R),main="R-line: log")
(z1 <- line(y=log(Ozone),x=log(Solar.R)))
abline(coef(z1))
z1.ls <- lm(log(Ozone) ~ log(Solar.R))
abline(z1.ls$coef, lty=2,col="red")
legend(x = 2, y = 4.5, c("R - Line", "Regression"), 
       lty=c(1,2),lwd=2,col = c("black","red"),cex=0.7)

plot(y=sqrt(Ozone),x=sqrt(Solar.R),main="R-line: sqrt")
(z2 <- line(y=sqrt(Ozone),x=sqrt(Solar.R)))
abline(coef(z2))
z2.ls <- lm(sqrt(Ozone) ~ sqrt(Solar.R))
abline(z2.ls$coef, lty=2,col="red")
legend(x = 3, y = 12, c("R - Line", "Regression"), 
       lty=c(1,2),lwd=2,col = c("black","red"),cex=0.7)

plot(residuals(z1) ~ fitted(z1), main = "Residual plot by rline: log") #오른쪽으로 잔차들이 몰리게 되었다는 점에서 부적절한 변환으로 보임.
abline(0,0)  
plot(residuals(z2) ~ fitted(z2), main = "Residual plot by rline: sqrt") #한개의 outlier만 제외 하면 전반적으로 변환 이전에 비해서 잔차들이 잘 퍼져있는 것으로 보임. 
abline(0,0)

boxplot(residuals(z1)) # outlier 없음
boxplot(residuals(z2)) # outlier 1개

stem(residuals(z1)) 
stem(residuals(z2)) 

# Y만 변환일 때에 비해 잔차들이 보이던 곡선의 경향성이 다소 완화되어진 것을 확인할 수 있다.


# Ozone ~ Wind
cor.test(Ozone,Wind)
plot(y=log(Ozone),x=Wind,main="R-line")
abline(line(y=log(Ozone),x=Wind)$coeff)
plot(line(y=log(Ozone),x=Wind)$residuals~line(y=log(Ozone),x=Wind)$fit)
abline(0,0) # 다소 곡선의 형태

plot(y=log(Ozone),x=log(Wind),main="R-line: log")
(z1 <- line(y=log(Ozone),x=log(Wind)))
abline(coef(z1))
z1.ls <- lm(log(Ozone) ~ log(Wind))
abline(z1.ls$coef, lty=2,col="red")
legend(x = 0.5, y = 4.5, c("R - Line", "Regression"), 
       lty=c(1,2),lwd=2,col = c("black","red"),cex=0.7)

plot(y=sqrt(Ozone),x=sqrt(Wind),main="R-line: sqrt")
(z2 <- line(y=sqrt(Ozone),x=sqrt(Wind)))
abline(coef(z2))
z2.ls <- lm(sqrt(Ozone) ~ sqrt(Wind))
abline(z2.ls$coef, lty=2,col="red")
legend(x = 1.5, y = 4, c("R - Line", "Regression"), 
       lty=c(1,2),lwd=2,col = c("black","red"),cex=0.7)

plot(residuals(z1) ~ fitted(z1), main = "Residual plot by rline: log") # Outlier 제외할 경우에도 약간의 곡선의 흔적이 남아있는 것으로 보임.
abline(0,0)  
plot(residuals(z2) ~ fitted(z2), main = "Residual plot by rline: sqrt") # 여전히 완벽하게 잔차를 퍼트리지는 못한 것으로 보이고 곡선의 흔적이 보임
abline(0,0)

boxplot(residuals(z1)) # outlier 3개
boxplot(residuals(z2)) # outlier 1개

stem(residuals(z1)) 
stem(residuals(z2)) 

# Y만 변환일 때에 비해 잔차들이 보이던 곡선의 경향성이 다소 완화되어진 것을 확인할 수 있다. 잔차들이 조금 더 y축을 기준으로 대칭적이 된 것을 확인할 수 있다.



# Ozone ~ Temp
cor.test(Ozone,Temp)
plot(y=log(Ozone),x=Temp,main="R-line")
abline(line(y=log(Ozone),x=Temp)$coeff)

plot(line(y=log(Ozone),x=Temp)$residuals~line(y=log(Ozone),x=Temp)$fitted)
abline(0,0) # outleir을 제외하더라도 다소 대칭적이지는 않아보임 (곡선 관계가 남아있는 것 같아보이지만 확실하지는 않음)

plot(y=log(Ozone),x=log(Temp),main="R-line: log")
(z1 <- line(y=log(Ozone),x=log(Temp)))
abline(coef(z1))
z1.ls <- lm(log(Ozone) ~ log(Temp))
abline(z1.ls$coef, lty=2,col="red")
legend(x = 4.05, y = 5., c("R - Line", "Regression"), 
       lty=c(1,2),lwd=2,col = c("black","red"),cex=0.7)

plot(y=sqrt(Ozone),x=sqrt(Temp),main="R-line: sqrt")
(z2 <- line(y=sqrt(Ozone),x=sqrt(Temp)))
abline(coef(z2))
z2.ls <- lm(sqrt(Ozone) ~ sqrt(Temp))
abline(z2.ls$coef, lty=2,col="red")
legend(x = 7.5, y = 12, c("R - Line", "Regression"), 
       lty=c(1,2),lwd=2,col = c("black","red"),cex=0.7)


plot(residuals(z1) ~ fitted(z1), main = "Residual plot by rline: log") # 곡선의 형태가 완화되고 잔차들이 y축을 기준으로 대칭되어 나타나는 것으로 보인다. 
abline(0,0)
plot(residuals(z2) ~ fitted(z2), main = "Residual plot by rline: sqrt") # 여전히 완벽하게 잔차를 퍼트리지는 못한 것으로 보이고 곡선의 흔적이 보임
abline(0,0)

boxplot(residuals(z1)) # outlier 4개
boxplot(residuals(z2)) # outlier 1개

stem(residuals(z1))  # 0을 기준으로 종모양이 나타남
stem(residuals(z2)) 

# 변환이후에는 변환 이전에 비해서 큰 차이가 없는 것 처럼 보이기는 한다. outlier들을 제외 하더라도 큰 차이는 없는 것으로 보인다.
```

```{r}
lmfit=lm(Ozone~Solar.R+Temp+Wind,data=airquality)
summary(lmfit)
lmfit2=lm(sqrt(Ozone)~(Solar.R)+(Temp)+(Wind),data=airquality)
summary(lmfit2)
lmfit3=lm(log(Ozone)~(Solar.R)+(Temp)+(Wind),data=airquality)
summary(lmfit3)
lmfit4=lm(sqrt(Ozone)~sqrt(Solar.R)+sqrt(Temp)+sqrt(Wind),data=airquality)
summary(lmfit4)
```

변환전 데이터로 회귀분석 기준으로 변수들의 설명력을 볼 경우 Wind, Temp, Solar.R순서이다. 다만, 변환이 이루어지지 않았기 때문에 극단치에 영향을 많이 받았을 가능성이 있다. Sqrt나 Log변환을 진행 한 이후 회귀분석을 진행하면 영향력이 강한 독립변수는 Wind, Temp, Solar.R동일한 순서인 것으로 보인다.

위에서 상관계수를 계산했을 때 확인했던 것처럼 Wind는 음의 회귀계수, 나머지 두 독립변수는 양의 회귀게수이다.

(결론)

Ozone 변수에 Sqrt를 취한 값에 대한 적합값의 잔차들을 제곱해서 더할 경우 다음과 같다. Solar.R: 596.0805 Wind: 489.5301 Temp: 332.194

잔차 제곱합의 기준에서 가장 작은 순서대로 fitting이 잘 되었다고 하였을 때, Temp, Wind, Solar.R 변수들의 순서로 Multiple r-line을 적합해보고자 한다.

## (나)

세 X 변수 사이의 종속성(dependency)을 X-Y 그래프로 직선 또는 곡선 관계의 경향이 있는 지 판단하여라. 세 변수가 한꺼번에 종속 관계가 있을 수 있으나 3차원 그래프를 이용해야 하므로 일단 세 변수 중 두 개씩 골라 X-Y 그래프를 그리고 두 변수 사이의 직선 또는 곡선 관계를 파악하여라. 필요한 경우에는 r-line으로 적합하여 판단하여라. (이러한 분석은 다중회귀식으로 모형을 확장할 때 필요한 작업이다)

```{r}
choose(3,2)
```

### Wind\~Solar.R

```{r}
attach(airquality)
plot(Wind~Solar.R,main="linearity of Solar.R ~ Wind")

cor.test(Wind,Solar.R) # 상관관계가 없음
cor.test(Wind,sqrt(Solar.R)) # 상관관계가 없음
cor.test(Wind,log(Solar.R)) # 상관관계가 없음
cor.test(Wind,log(Solar.R)) # 상관관계가 없음
cor.test(Wind,sqrt(Solar.R)) # 상관관계가 없음
detach(airquality)
```

태양 복사와 바람 변수는 서로 관계가 없는 것으로 보인다.

### Wind\~Temp

```{r}
attach(airquality)
plot(Wind~Temp,main="linearity of Wind ~ Temp")

(z <- line(x=Temp,y=Wind))
abline(coef(z))
z.ls <- lm(Wind~Temp)
abline(z.ls$coef, lty=2,col="red")
legend(x = 58, y = 5, c("R - Line", "Regression"), 
       lty=c(1,2),lwd=2,col = c("black","red"),cex=0.7)

cor.test(Wind,Temp,na.rm=T) #음의 상관관계


airquality4=airquality[order(airquality$Temp),]

medWind <- as.vector(3)
medTemp <- as.vector(3)
medWind[1] <- median(airquality4$Wind[1:51],na.rm=T); medTemp[1] <- median(airquality4$Temp[1:51],na.rm=T)
medWind[2] <- median(airquality4$Wind[52:102],na.rm=T); medTemp[2] <- median(airquality4$Temp[52:102],na.rm=T)
medWind[3] <- median(airquality4$Wind[103:153],na.rm=T); medTemp[3] <- median(airquality4$Temp[103:153],na.rm=T)
plot(medWind ~ medTemp, type="b") 
#감소하는 Concave 한 곡선형태

plot(y=log(Wind),x=Temp,main="Linearity of log Wind and temp")
(z1<- line(y=log(Wind),x=(Temp)))
abline(coef(z1))
z1.ls <- lm(log(Wind) ~ Temp)
abline(z1.ls$coef, lty=2,col="red")
legend(x = 58, y = 1, c("R - Line", "Regression"), 
       lty=c(1,2),lwd=2,col = c("black","red"),cex=0.7)

plot(y=sqrt(Wind),x=Temp,main="Linearity of sqrt Wind and temp")
(z1<- line(y=sqrt(Wind),x=(Temp)))
abline(coef(z1))
z1.ls <- lm(sqrt(Wind) ~ Temp)
abline(z1.ls$coef, lty=2,col="red")
legend(x = 58, y = 2, c("R - Line", "Regression"), 
       lty=c(1,2),lwd=2,col = c("black","red"),cex=0.7)

t2=Temp^2
plot(y=Wind,x=t2,main="Linearity of Wind and temp^2")
(z1<- line(y=(Wind),x=t2))
abline(coef(z1))
z1.ls <- lm(Wind ~ t2)
abline(z1.ls$coef, lty=2,col="red")
legend(x = 3300, y = 5, c("R - Line", "Regression"), 
       lty=c(1,2),lwd=2,col = c("black","red"),cex=0.7)

plot(residuals(z1) ~ fitted(z1), main = "Residual plot by rline") #가장 적절해 보인다
abline(0,0) 
plot(residuals(z2) ~ fitted(z2), main = "Residual plot by rline")
abline(0,0) 
plot(residuals(z3) ~ fitted(z3), main = "Residual plot by rline")
abline(0,0) 

boxplot(residuals(z1)) # 2 outliers
boxplot(residuals(z2)) # 3 outliers
boxplot(residuals(z3)) # 3 outliers

stem(residuals(z1))
stem(residuals(z2))
stem(residuals(z3))

cor.test(log(Wind),Temp,na.rm=T) #음의 상관관계
cor.test(sqrt(Wind),Temp,na.rm=T) #음의 상관관계
cor.test(Wind,t2,na.rm=T) #음의 상관관계
detach(airquality)
```

Temp와 Wind변수는 서로 음의 상관관계가 나타나는 것으로 보인다. Temp와 log(Wind)변수의 관계는 선형성이 잘 드러나는 것으로 보이며 Boxplot을 통해 확인한 두개의 Outlier들을 제거하면 잔차들도 잘 퍼져있는 것을 확인할 수 있다.

### Temp\~Solar.R

```{r}
attach(airquality)
plot(Temp~Solar.R,main="linearity of Temp ~ Solar.R")

(z <- line(x=Solar.R,y=Temp))
abline(coef(z))
z.ls <- lm(Temp~Solar.R)
abline(z.ls$coef, lty=2,col="red")
legend(x = 10, y = 95, c("R - Line", "Regression"), 
       lty=c(1,2),lwd=2,col = c("black","red"),cex=0.7)

cor.test(Temp,Solar.R,na.rm=T) #음의 상관관계


airquality5=airquality[order(airquality$Solar.R),]

medSolar <- as.vector(3)
medTemp <- as.vector(3)
medSolar[1] <- median(airquality5$Solar.R[1:51],na.rm=T); medTemp[1] <- median(airquality5$Temp[1:51],na.rm=T)
medSolar[2] <- median(airquality5$Solar.R[52:102],na.rm=T); medTemp[2] <- median(airquality5$Temp[52:102],na.rm=T)
medSolar[3] <- median(airquality5$Solar.R[103:153],na.rm=T); medTemp[3] <- median(airquality5$Temp[103:153],na.rm=T)
plot(medTemp ~ medSolar, type="b") 
# Concave 한곡선 형태

plot(y=log(Temp),x=Solar.R,main="Linearity of log Temp and Solar.R")
(z1<- line(y=log(Temp),x=Solar.R))
abline(coef(z1))
z1.ls <- lm(log(Temp) ~ Solar.R)
abline(z1.ls$coef, lty=2,col="red")
legend(x = 10, y =4.57, c("R - Line", "Regression"), 
       lty=c(1,2),lwd=2,col = c("black","red"),cex=0.7)

plot(y=sqrt(Temp),x=Solar.R,main="Linearity of sqrt Temp and Solar.R")
(z1<- line(y=sqrt(Temp),x=(Solar.R)))
abline(coef(z1))
z1.ls <- lm(sqrt(Temp) ~ Solar.R)
abline(z1.ls$coef, lty=2,col="red")
legend(x = 10, y = 9.8, c("R - Line", "Regression"), 
       lty=c(1,2),lwd=2,col = c("black","red"),cex=0.7)

s2=Solar.R^2
plot(y=Temp,x=s2,main="Linearity of Temp and Solar.R^2")
(z1<- line(y=Temp,x=s2))
abline(coef(z1))
z1.ls <- lm(Temp ~ s2)
abline(z1.ls$coef, lty=2,col="red")
legend(x = 100, y =97, c("R - Line", "Regression"), 
       lty=c(1,2),lwd=2,col = c("black","red"),cex=0.5)

plot(residuals(z1) ~ fitted(z1), main = "Residual plot by rline") # 곡선 모양인 것으로 보인다.
abline(0,0) 
plot(residuals(z2) ~ fitted(z2), main = "Residual plot by rline")
abline(0,0) 
plot(residuals(z3) ~ fitted(z3), main = "Residual plot by rline")
abline(0,0) 

boxplot(residuals(z1)) # 1 outliers
boxplot(residuals(z2)) # 2 outliers
boxplot(residuals(z3)) # 3 outliers

stem(residuals(z1))
stem(residuals(z2))
stem(residuals(z3))

cor.test(log(Temp),Solar.R,na.rm=T)
cor.test(sqrt(Temp),Solar.R,na.rm=T)
cor.test(Temp,s2,na.rm=T)

detach(airquality)
```

Solar.R변수와 Temp 변수는 서로 양의 상관관계를 가지고 있다. (다만 2차함수 곡선의 관계인 것으로 보인다.) 변환을 통해 그러한 경향성을 완화시키고자 하였는데 log변환의 경우 여전히 Residual Plot에서 곡선의 경향성이 남아있다 반면, Sqrt 변환은 위의 두개의 Outlier을 제외하면 곡선의 경향성이 다소 완화되어진 것으로 보인다.

정리하면 세개의 변수들을 서로 상관성이 있는 것으로 보이며, multicollinearity issue가 발생할 수 있기 대문에 회귀분석을 진행할 때 유의해야 할 것으로 보인다. (wind \<-- Temp \<-- Solar.R, 한단계 거친 상관성)

결측치 자료를 불완전 자료(incomplete data, missing data)라고 하고 불완전하지만 정보를 갖고 있으니 최대한 살려서 분석하려고 하는 시도는 당연한 것이다. missing 된 부분을 다른 자료들의 패턴을 이용하여 complete로 만들어 사용하려는 방법들이 Sampling (표본조사론) 분야에서 연구되고 있다. 당연히 Bayesian 방법도 가능하다. EDA 분야까지 응용되지는 않고 있다. (말 그대로 E=exploration, 있는 그대로 explore 해야지)

# 3번

## (가)

trees 자료를 multiple r-line으로 적합하여라.

```{r}
attach(trees)

cor.test(log(Height),log(Girth))
cor.test(log(Height),log(Volume))

summary(lm(log(Height)~log(Girth)+log(Volume),data=trees))

# 1) Height ~ Volume --> Girth
plot(log(Height)~log(Volume),main="Linearity of log Height ~ log Volume")
(z1 <- line(x=log(Volume),y=log(Height)))
abline(coef(z1),lty=2,col="red")

plot(residuals(z1) ~ fitted(z1), main = "Residual plot by multiple rline: log Height ~ log Volume")
abline(0,0)

plot(residuals(z1)~log(Girth),main="Linearity of Residuals ~ log Girth")
(z2 <- line(x=log(Girth),y=residuals(z1)))
abline(coef(z2),lty=2,col="red")

plot(residuals(z2) ~ fitted(z2), main = "Residual plot by multiple rline: Residual ~ log Girth")
abline(0,0)

stem(residuals(z2)) # 0을 기준으로 대칭적인 종모양
boxplot(residuals(z2)) # outlier 1개

# 끝에 있는 한 점만 제외하면 전반적으로 Residual들이 적합이 잘 된 것으로 보인다.

sum(residuals(z1)^2)


# 2) Height ~  Girth --> Volume 

plot(log(Height)~log(Girth),main="Linearity of log Height ~ log Girth")
(z3 <- line(x=log(Girth),y=log(Height)))
abline(coef(z3),lty=2,col="red")

plot(residuals(z3) ~ fitted(z3), main = "Residual plot by multiple rline: log Height ~ log Girth")
abline(0,0)

plot(y=residuals(z3),x=log(Volume),main="Linearity of Residuals ~ log Volume")
(z4 <- line(y=residuals(z3),x=log(Volume)))
abline(coef(z4),lty=2,col="red")

plot(residuals(z4) ~ fitted(z4), main = "Residual plot by multiple rline: Residual ~ log Volume")
abline(0,0)

# 끝에 있는 한 점만 제외하면 전반적으로 Residual들이 적합이 잘 된 것으로 보인다.

stem(residuals(z4)) #0 을 기준으로 대칭적인 종모양
boxplot(residuals(z4)) # outlier 1개


sum(residuals(z3)^2)

detach(trees)

```

두가지 방식 중 첫번째 방식이 더 적합해 보이는 것으로 보인다. 잔차 제곱의 합의 값이 첫번째 방식이 더 작게 나타나고 있기 때문이다. . 또한 회귀분석을 같이 놓고 돌렸을 때 계수의 값이 더 크게 나타나는 것을 확인할 수 있다.

## (나)

airquality 자료를 multiple r-line으로 적합하여라.

Ozone \~ Temp ==\> Wind ==\> Solar.R (위에서 이유는 이미 언급함)

```{r}
data(airquality)

air2=airquality[!is.na(airquality$Ozone),]
air2
air2=air2[!is.na(air2$Solar.R),]

dim(air2)
colSums(is.na(air2))
attach(air2)


# 결측치들을 Drop해서 중간에 Fit에서 Length가 안 맞아서 생기는 오류를 해결하고자 하였음.

plot(y=sqrt(Ozone),x=Temp,main="Linearity of sqrt Ozone ~ Temp")
(z <- line(x=Temp,y=sqrt(Ozone)))
abline(coef(z),lty=2,col="red")


plot(residuals(z) ~ fitted(z), main = "Residual plot by multiple rline: sqrt Ozone ~ Temp")
abline(0,0)


plot(y=residuals(z),x= Wind, main="Linearity of residuals ~ Wind")
(z1 <- line(x=Wind,y=residuals(z)))
abline(coef(z1),lty=2,col="red")

plot(residuals(z1) ~ fitted(z1), main = "Residual plot by multiple rline: residuals ~ Wind")
abline(0,0)


plot(y=residuals(z1),x=Solar.R,main="Linearity of residuals ~ Solar.R")
(z2 <- line(x=Solar.R,y=residuals(z1)))
abline(coef(z2),lty=2,col="red")

plot(residuals(z2) ~ fitted(z2), main = "Residual plot by multiple rline: residuals ~ Solar.R")
abline(0,0)

sum(residuals(z2)^2) # 328.3632
detach(air2)


```

Ozone \~ Wind ==\> Temp ==\> Solar.R (회귀분석 회귀계수가 큰 순서대로 )

```{r}
data(airquality)

air2=airquality[!is.na(airquality$Ozone),]
air2
air2=air2[!is.na(air2$Solar.R),]

dim(air2)
colSums(is.na(air2))
attach(air2)


# 결측치들을 Drop해서 중간에 Fit에서 Length가 안 맞아서 생기는 오류를 해결하고자 하였음.

plot(y=sqrt(Ozone),x=(Wind),main="Linearity of sqrt Ozone ~ Wind")
(z <- line(x=(Wind),y=sqrt(Ozone)))
abline(coef(z),lty=2,col="red")


plot(residuals(z) ~ fitted(z), main = "Residual plot by multiple rline: sqrt Ozone ~ Wind")
abline(0,0)


plot(y=residuals(z),x=Temp,main="Linearity of residuals ~ Temp")
(z1 <- line(x=Temp,y=residuals(z)))
abline(coef(z1),lty=2,col="red")

plot(residuals(z1) ~ fitted(z1), main = "Residual plot by multiple rline: residuals ~ Temp")
abline(0,0)


plot(y=residuals(z1),x=Solar.R,main="Linearity of residuals ~ Solar.R")
(z2 <- line(x=Solar.R,y=residuals(z1)))
abline(coef(z2),lty=2,col="red")

plot(residuals(z2) ~ fitted(z2), main = "Residual plot by multiple rline: residuals ~ Solar.R")
abline(0,0)

sum(residuals(z2)^2) #360.3426

detach(air2)

```

아래의 방식보다 위의 방식에서 잔차제곱의 합이 작게 나타난다. 따라서 위의 방식에서의 적합이 더 잘 이루어졌음을 확인해볼 수 있다.

주의: multiple R-line은 sequential 방법이다. simultaneous 방법으로 하면 다른 결과 나올 수 있다.
